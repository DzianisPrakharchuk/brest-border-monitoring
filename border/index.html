
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Brest border monitoring</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { margin-top: 30px; }
    button { padding: 10px 20px; font-size: 16px; margin-bottom: 20px; }
    .group { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>📊 Brest border statistics</h1>
  <button onclick="loadData()">🔄 Update</button>

<h2>🚗 Cars</h2>
<div id="carStats"></div>

<h2>🚌 Buses</h2>
<div id="busStats"></div>

<h2>🚨 Priority cars</h2>
<div id="priorityStats"></div>

  <script>
    async function loadData() {
      const url = "https://belarusborder.by/info/monitoring-new?token=test&checkpointId=a9173a85-3fc0-424c-84f0-defa632481e4";
      try {
        const response = await fetch(url, {
          headers: { "accept": "application/json, text/plain, */*" },
          method: "GET"
        });
        const data = await response.json();

        const carStats = processVehicles(data.carLiveQueue || []);
        const busStats = processVehicles(data.busLiveQueue || []);
        const priorityStats = processVehicles(data.carPriority || []);

        renderStats("carStats", carStats, true);         
        renderBusStats("busStats", busStats);           
        renderStats("priorityStats", priorityStats, true); 
      } catch (error) {
        console.error("Load error:", error);
      }
    }


function processVehicles(queue) {
  const regionGroups = {};
  let euCount = 0;
  let total = 0;

  queue.forEach(item => {
    const plate = item.regnum;
    if (!plate) return;

    total++;

    const isEU = /^[A-Z]{1,3}/.test(plate) && !/\d{4}\s?[A-Z]{2}-\d/.test(plate);
    if (isEU) {
      euCount++;
    } else {
      const digits = plate.match(/\d/g);
      const region = digits ? digits[digits.length - 1] : null;
      if (region) {
        regionGroups[region] = (regionGroups[region] || 0) + 1;
      }
    }
  });

  return { regionGroups, euCount, total };
}


function renderStats(containerId, stats, sort = true) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  let entries = Object.entries(stats.regionGroups);

  if (sort) {
    entries = entries.sort((a, b) => b[1] - a[1]);
  }

  if (entries.length > 0) {
    entries.forEach(([region, count]) => {
      const div = document.createElement("div");
      div.className = "group";
      div.textContent = `Region ${region}: ${count}`;
      container.appendChild(div);
    });
  }

  if (stats.euCount > 0) {
    const euDiv = document.createElement("div");
    euDiv.className = "group";
    euDiv.textContent = `EU: ${stats.euCount}`;
    container.appendChild(euDiv);
  }

  const totalDiv = document.createElement("div");
  totalDiv.className = "group";
  totalDiv.style.fontWeight = "bold";
  totalDiv.textContent = `Total: ${stats.total}`;
  container.appendChild(totalDiv);

  if (entries.length === 0 && stats.euCount === 0 && stats.total === 0) {
    container.innerHTML = "<p>⚠️ No data available.</p>";
  }
}

function renderBusStats(containerId, stats) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  const totalDiv = document.createElement("div");
  totalDiv.className = "group";
  totalDiv.style.fontWeight = "bold";
  totalDiv.textContent = `Total: ${stats.total}`;
  container.appendChild(totalDiv);

  if (stats.total === 0) {
    container.innerHTML = "<p>⚠️ No data available.</p>";
  }
}
   
    loadData();
  </script>
</body>
</html>
